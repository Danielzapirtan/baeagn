name: Simple ZX Basic Runner
on: [push, pull_request]

jobs:
  run-basic:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install tools
        run: sudo apt-get install -y fuse-emulator-utils bas2tap
        
      - name: Create and run test program
        run: |
          # Create a sample chess engine placeholder
          cat > chess_engine.bas << 'EOF'
          10 REM ZX Spectrum Chess Engine
          20 REM FEN: rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1
          30 PRINT "Chess Engine v1.0"
          40 PRINT "Initial position loaded"
          50 PRINT "Thinking..."
          60 FOR T=1 TO 1000: NEXT T
          70 PRINT "Best move: e2-e4"
          80 PRINT "Evaluation: +0.3"
          90 PRINT "Nodes: 1250"
          100 PRINT "Time: 2.5s"
          110 STOP
          EOF
          
          # Convert to tape
          bas2tap chess_engine.bas chess_engine.tap
          
          # Run and capture output (with auto-load)
          echo "=== Program Output ==="
          timeout 10s fuse --tape chess_engine.tap --machine 48 --auto-load --interface none 2>&1 | tee output.log
          
      - name: Check output
        run: |
          if grep -q "Error\\|BREAK" output.log; then
            echo "❌ Program had errors"
            exit 1
          elif grep -q "Best move" output.log; then
            echo "✅ Chess engine completed successfully"
          else
            echo "⚠️  Program ran but may not have completed"
          fi